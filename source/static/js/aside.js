// Generated by CoffeeScript 1.10.0
$(function() {
  var full, inst, showIcon, toc, up;
  up = $('.icon-arrow-up');
  up.click(function() {
    $('html, body, .fullscreen').animate({
      scrollTop: 0
    }, 1000);
  });
  showIcon = function(top) {
    if (top > 1000) {
      up.show();
    } else {
      up.hide();
    }
  };
  $(window).scroll(function() {
    showIcon($(this).scrollTop());
  });
  toc = $('[data-remodal-id=toc]');
  inst = toc.remodal();
  toc.click(function() {
    inst.close();
  });
  $(document).on('opening', '[data-remodal-id=comment]', function() {
    $.getScript('//static.duoshuo.com/embed.js');
  });
  full = $('.icon-fullscreen');
  full.click(function(e) {
    screenfull.toggle('', function(isFullscreen) {
      if (!isFullscreen) {
        full.attr('title', '全屏').addClass('icon-fullscreen').removeClass('icon-screenshot');
      } else {
        full.attr('title', '取消全屏').addClass('icon-screenshot').removeClass('icon-fullscreen');
      }
    });
  });
  $(document).on('opening', '[data-remodal-id=summary]', function() {
    var arr_path, arr_url, dir, i, j, len, path, url;
    path = window.location.pathname;
    arr_path = path.split('/');
    arr_url = [];
    for (i = j = 0, len = arr_path.length; j < len; i = ++j) {
      dir = arr_path[i];
      if (i < 3) {
        arr_url.push(dir);
      }
    }
    url = '//' + window.location.host + arr_url.join('/') + '/summary/index.json';
    $.getJSON(url, function(json) {
      var file_name, option;
      $('article.summary').html(json.summary);
      option = $('article.summary a[href="' + path + '"]');
      file_name = option.html();
      option.html('<span style="color:orange">' + file_name + '</span>');
    });
  });
});

screenfull.toggle = function(elem, fn) {
  if (this.isFullscreen) {
    this.exit();
    fn(false);
  } else {
    this.request(elem);
    fn(true);
  }
};
